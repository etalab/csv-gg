(function(e){function t(t){for(var i,a,o=t[0],l=t[1],u=t[2],d=0,f=[];d<o.length;d++)a=o[d],Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&f.push(s[a][0]),s[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(e[i]=l[i]);c&&c(t);while(f.length)f.shift()();return r.push.apply(r,u||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,o=1;o<n.length;o++){var l=n[o];0!==s[l]&&(i=!1)}i&&(r.splice(t--,1),e=a(a.s=n[0]))}return e}var i={},s={app:0},r=[];function a(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=i,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(n,i,function(t){return e[t]}.bind(null,i));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var c=l;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0b50":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var i,s,r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("b-container",[n("h1",{staticClass:"text-center mt-2"},[n("img",{attrs:{src:"/assets/csvgg.gif",alt:"csv-gg"}})]),n("router-view"),n("footer",{staticClass:"text-center"},[n("hr"),n("p",{staticClass:"mb-0"},[n("strong",[e._v("csv-gg")]),e._v(" est un "),n("a",{attrs:{title:"dépôt github",href:"https://github.com/etalab/csv-gg"}},[e._v("logiciel libre")]),e._v(" développé par "),n("a",{attrs:{title:"site d'Etalab",href:"https://www.etalab.gouv.fr/"}},[e._v("Etalab")]),e._v(".\n            ")]),n("p",{staticClass:"mt-0"},[n("span",{staticClass:"badge badge-pill badge-warning"},[e._v("Attention")]),e._v(" il s'agit d'un projet expérimental. En cas de question ou de problème, vous pouvez "),n("a",{attrs:{title:"ouvrir un ticket",href:"https://github.com/etalab/csv-gg/issues/new"}},[e._v("ouvrir un ticket ici")]),e._v(" ou nous "),n("a",{attrs:{title:"contact mail",href:"mailto:validation@data.gouv.fr?subject=A%20propos%20de%20csv-gg"}},[e._v("envoyer un email")]),e._v(".\n            ")])])],1)],1)},o=[],l=n("2877"),u={},c=Object(l["a"])(u,a,o,!1,null,null,null),d=c.exports,f=n("8c4f"),m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-alert",{attrs:{show:"",dismissible:""}},[n("h4",{staticClass:"alert-heading"},[e._v("Mode d'emploi")]),n("p",[e._v("Cet outil vous permet de créer un fichier CSV en vous assurant qu'il est conforme à un schéma, c'est-à-dire que ses données sont complètes, valides et structurées.")]),n("ol",{staticClass:"mb-0"},[n("li",[e._v("Sélectionnez le schéma qui vous intéresse dans la liste déroulante, les schémas disponibles ici étant ceux référencés sur "),n("a",{attrs:{href:"https://schema.data.gouv.fr"}},[e._v("schema.data.gouv.fr")]),e._v(".")]),n("li",[e._v("Remplissez le formulaire à l'aide des descriptions des différents champs et des valeurs d'exemples. Les champs indiqués par un astérisque rouge doivent obligatoirement être renseignés au moment de la saisie.")]),n("li",[e._v("L'outil vous prévient d'éventuelles erreurs de validation, le cas échéant vous pouvez les corriger.")]),n("li",[e._v("Une fois votre formulaire valide, les valeurs apparaissent sous la forme d'une ligne dans un tableau récapitulatif.")]),n("li",[e._v("Vous pouvez alors choisir d'ajouter une ou plusieurs lignes (répétez les étapes 2 à 4) ou télécharger le fichier CSV correspondant au tableau récapitulatif.")]),e.schema&&"etalab/schema-lieux-covoiturage"===e.schema.name?n("li",[e._v("Une fois votre fichier complété et téléchargé, vous pouvez l'envoyer à "),n("a",{attrs:{href:"mailto:contact@transport.beta.gouv.fr"}},[e._v("contact@transport.beta.gouv.fr")]),e._v(" pour qu'il soit intégré à la base nationale.")]):e._e()])]),n("b-form-group",{staticClass:"my-4",attrs:{label:"Choisissez un schéma à utiliser :",description:e.schema&&e.schema.description?e.schema.description:""}},[n("b-form-select",{attrs:{options:e.options},model:{value:e.schemaName,callback:function(t){e.schemaName=t},expression:"schemaName"}},[n("template",{slot:"first"},[n("option",{attrs:{disabled:""},domProps:{value:null}},[e._v("Choisissez un schéma")])])],2)],1),e.schema&&"etalab/schema-lieux-covoiturage"===e.schema.name?n("b-alert",{attrs:{show:"",dismissible:""}},[n("div",[e._v("Pour toute question, n'hésitez pas à adresser un mail à "),n("a",{attrs:{href:"mailto:contact@transport.beta.gouv.fr"}},[e._v("contact@transport.beta.gouv.fr")])])]):e._e(),e.schema?n("schema-form",{attrs:{"schema-meta":e.schema,"schema-name":e.schemaName}}):e._e()],1)},h=[],p=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),v=(n("7514"),n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.lines.length>0?n("div",{staticClass:"my-4"},[n("b-table",{attrs:{striped:"",hover:"",items:e.items,fields:e.fields},scopedSlots:e._u([{key:"actions",fn:function(t){return[n("b-button",{staticClass:"mr-1",attrs:{size:"sm",variant:"danger"},on:{click:function(n){return e.deleteLine(t.index)}}},[e._v("\n                  Supprimer\n              ")])]}}],null,!1,359536991)}),n("b-button",{staticClass:"mr-2",attrs:{href:e.csvLink,download:e.filename,type:"button",variant:"primary"}},[e._v("Télécharger le CSV")]),n("b-button",{attrs:{disabled:e.addingLine,type:"button",variant:"primary"},on:{click:function(t){return t.preventDefault(),e.addLine(t)}}},[e._v("Ajouter une ligne")])],1):e._e(),n("b-form",{directives:[{name:"show",rawName:"v-show",value:e.addingLine,expression:"addingLine"}],staticClass:"my-4",attrs:{novalidate:""},on:{submit:function(t){return t.preventDefault(),e.submit(t)}}},[n("div",{ref:"container"}),n("b-button",{attrs:{type:"submit",variant:"primary",disabled:!e.hasValues}},[e._v("Valider la ligne")])],1)],1)}),b=[],g=(n("6762"),n("2fdb"),n("8615"),n("75fc")),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("FormGroup",{attrs:{field:e.field,error:e.error}},[n("b-form-input",{attrs:{id:"field-"+e.field.name,type:e.type,placeholder:e.field.example,required:e.isRequired,min:e.field.constraints?e.field.constraints.minimum:null,max:e.field.constraints?e.field.constraints.maximum:null,state:e.isValid,trim:!0},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}),e.isInsee&&e.city?n("div",{staticClass:"mt-2 valid-feedback d-block"},[e._v("Ce code INSEE correspond à "+e._s(this.city)+".")]):e._e(),e.isInsee&&!e.city&&e.value?n("div",{staticClass:"mt-2 invalid-feedback d-block"},[e._v("Ce code INSEE n'existe pas.")]):e._e(),e.isSiret&&e.siretDescription?n("div",{staticClass:"mt-2 valid-feedback d-block"},[e._v("Ce SIRET correspond à "+e._s(this.siretDescription)+".")]):e._e(),e.isSiret&&!e.siretDescription&&e.value?n("div",{staticClass:"mt-2 invalid-feedback d-block"},[e._v("Ce code SIRET n'existe pas.")]):e._e(),e.isSiren&&e.sirenDescription?n("div",{staticClass:"mt-2 valid-feedback d-block"},[e._v("Ce SIREN correspond à "+e._s(this.sirenDescription)+".")]):e._e(),e.isSiren&&!e.sirenDescription&&e.value?n("div",{staticClass:"mt-2 invalid-feedback d-block"},[e._v("Ce code SIREN n'existe pas.")]):e._e(),e.isPostCode&&e.city?n("div",{staticClass:"mt-2 valid-feedback d-block"},[e._v("Ce code postal correspond à "+e._s(this.city)+".")]):e._e(),e.isPostCode&&!e.city&&e.value?n("div",{staticClass:"mt-2 invalid-feedback d-block"},[e._v("Ce code code postal n'existe pas.")]):e._e()],1)},y=[],w=(n("3b2b"),new r["a"]),C={props:{field:Object},data:function(){return{error:!1,formValidated:!1,value:null}},mounted:function(){var e=this;w.$on("field-error",(function(t,n){e.field.name===t&&(e.error=n)})),w.$on("field-no-error",(function(t){e.field.name===t&&(e.error=!1)})),w.$on("form-validated",(function(){e.formValidated=!0})),w.$on("form-reset",(function(){e.formValidated=!1,e.error=!1,e.value=null}))},computed:{isValid:function(){return this.formValidated?!this.error:null},isRequired:function(){return!!this.field.constraints&&this.field.constraints.required}},methods:{onInput:function(e){this.formValidated=!1,this.error=!1,w.$emit("field-value-changed",this.field.name,e)}}},j=C,x=(n("7857"),Object(l["a"])(j,i,s,!1,null,null,null)),O=x.exports,k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-form-group",{attrs:{"label-cols-sm":"4","label-cols-lg":"3",label:e.field.name,"label-for":"field-"+e.field.name,"invalid-feedback":e.error.content,"valid-feedback":"Ce champ est valide",state:e.isValid,"label-class":{required:e.isRequired}}},[n("template",{slot:"description"},[n("vue-markdown",{attrs:{source:e.field.description}})],1),e._t("default")],2)},S=[],N=n("9ce6"),V=n.n(N),F={name:"FormGroup",mixins:[O],components:{VueMarkdown:V.a}},E=F,L=Object(l["a"])(E,k,S,!1,null,null,null),$=L.exports,I={name:"StringField",mixins:[O],components:{FormGroup:$},data:function(){return{city:null,siretDescription:null,sirenDescription:null}},mounted:function(){var e=this;w.$on("field-value-changed",(function(t,n){e.field.name===t&&(e.isInsee?e.handleInseeInput(n):e.isSiret?e.handleSiretInput(n):e.isSiren?e.handleSirenInput(n):e.isPostCode&&e.handlePostcodeInput(n))}))},methods:{handleInseeInput:function(e){var t=this;fetch("https://geo.api.gouv.fr/communes/".concat(e)).then((function(e){if(!e.ok)throw t.city=null,new Error("Not 200 response");return e.json()})).then((function(e){t.city=e.nom})).catch((function(e){return e}))},handleSiretInput:function(e){var t=this;this.siretDescription=null,14===e.length&&fetch("https://entreprise.data.gouv.fr/api/sirene/v3/etablissements/".concat(e)).then((function(e){if(!e.ok)throw t.siretDescription=null,new Error("Not 200 response");return e.json()})).then((function(e){t.siretDescription=e.etablissement.unite_legale.denomination})).catch((function(e){return e}))},handleSirenInput:function(e){var t=this;this.sirenDescription=null,9===e.length&&fetch("https://entreprise.data.gouv.fr/api/sirene/v3/unites_legales/".concat(e)).then((function(e){if(!e.ok)throw t.sirenDescription=null,new Error("Not 200 response");return e.json()})).then((function(e){t.sirenDescription=e.unite_legale.denomination})).catch((function(e){return e}))},handlePostcodeInput:function(e){var t=this;fetch("https://geo.api.gouv.fr/communes?codePostal=".concat(e,"&boost=population")).then((function(e){if(!e.ok)throw t.city=null,new Error("Not 200 response");return e.json()})).then((function(e){t.city=e.map((function(e){return e.nom})).join(" ou ")})).catch((function(e){return e}))},fieldHasKeyword:function(e){var t=this.field.name.toLowerCase(),n=(this.field.description||"").toLowerCase();return t.includes(e)||new RegExp("\\b".concat(e,"\\b")).test(n)}},computed:{type:function(){return["number","float"].includes(this.field.type)?"number":"email"===this.field.format?"email":"text"},isInsee:function(){return this.field.name.toLowerCase().includes("insee")},isSiret:function(){return this.fieldHasKeyword("siret")},isSiren:function(){return this.fieldHasKeyword("siren")},isPostCode:function(){return["codepostal","code-postal","code_postal"].includes(this.field.name.toLowerCase())}}},P=I,D=Object(l["a"])(P,_,y,!1,null,null,null),q=D.exports,R=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("FormGroup",{attrs:{field:e.field,error:e.error}},[n("b-form-select",{attrs:{id:"field-"+e.field.name,options:e.options,state:e.isValid},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)},z=[],M={name:"SelectField",mixins:[O],components:{FormGroup:$},computed:{options:function(){return this.field.constraints.enum}}},G=M,H=Object(l["a"])(G,R,z,!1,null,null,null),T=H.exports,A=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("FormGroup",{attrs:{field:e.field,error:e.error}},[n("b-form-radio-group",{attrs:{id:"field-"+e.field.name,options:e.options,state:e.isValid},on:{input:e.onInput},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1)},U=[],K={name:"RadioField",mixins:[O],components:{FormGroup:$},computed:{options:function(){var e=[{text:"Vrai",value:this.trueValue},{text:"Faux",value:this.falseValue}];return this.field.constraints&&this.field.constraints.required?e:(e.push({text:"Non renseigné",value:""}),e)},trueValue:function(){return this.field.trueValues?this.field.trueValues[0]:"true"},falseValue:function(){return this.field.falseValues?this.field.falseValues[0]:"false"}}},B=K,J=Object(l["a"])(B,A,U,!1,null,null,null),Q=J.exports,W=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("FormGroup",{attrs:{field:e.field,error:e.error}},[n("vue-simple-suggest",{attrs:{"display-attribute":"label","value-attribute":"label",list:e.getSuggestionList,"min-length":3,debounce:200},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],staticClass:"form-control",attrs:{id:e.inputId,type:"text",placeholder:e.placeholder,required:e.isRequired,state:e.isValid},domProps:{value:e.value},on:{change:e.onChange,input:function(t){t.target.composing||(e.value=t.target.value)}}})])],1)},X=[],Y=n("5111"),Z=n("72bf"),ee=n.n(Z),te={name:"AddressField",mixins:[O],components:{FormGroup:$,VueSimpleSuggest:Y["a"]},data:function(){return{value:""}},methods:{getSuggestionList:function(e){return new Promise((function(t,n){var i=ee.a.stringifyUrl({url:"https://api-adresse.data.gouv.fr/search/",query:{q:e}});fetch(i).then((function(e){e.ok||n(),e.json().then((function(e){t(e.features.map((function(e){return{label:e.properties.label}})))})).catch((function(e){n(e)}))}))}))},onChange:function(){var e=this.value;w.$emit("field-error",this.field.name,!1),w.$emit("field-value-changed",this.field.name,e)}},computed:{placeholder:function(){return this.field.example||"3 rue des Mimosas"},inputId:function(){return"field-".concat(this.field.name)}},mounted:function(){var e=this;w.$on("form-reset",(function(){e.value=""}))}},ne=te,ie=(n("a036"),Object(l["a"])(ne,W,X,!1,null,null,null)),se=ie.exports,re="https://api.validata.etalab.studio",ae={name:"schemaForm",components:{},props:{schemaMeta:Object,schemaName:String},data:function(){return{schema:{},errors:{},values:{},fieldNames:[],faultyFields:[],lines:[],formValidated:!1,addingLine:!0,hasValues:!1,fieldNodes:[]}},watch:{schemaMeta:function(){this.removeFieldNodes(),this.lines=[],this.addingLine=!0,this.fieldNames=[],this.formValidated=!1,this.hasValues=!1,this.values={},this.errors={},this.faultyFields=[],this.buildForm()}},mounted:function(){var e=this;this.buildForm(),w.$on("field-value-changed",(function(t,n){e.values[t]=n,e.computeHasValues()}))},computed:{filename:function(){var e=new Date,t=[this.schemaName,e.toISOString()].join("_");return"".concat(t,".csv")},fields:function(){return[].concat(Object(g["a"])(this.fieldNames.map((function(e){return{key:e,label:e}}))),[{key:"actions",label:""}])},csvLink:function(){var e=this.buildFullCsvContent(),t=new Blob(["\ufeff"+e],{type:"text/csv"});return window.URL.createObjectURL(t)},items:function(){var e=this;return this.lines.map((function(t){var n={};return e.fieldNames.forEach((function(e,i){n[e]=t[i]})),n}))}},methods:{buildForm:function(){var e=this,t=this.$loading.show();fetch(this.schemaMeta.schema_url).then((function(e){return e.json()})).then((function(t){e.schema=t,e.schema.fields.forEach((function(t){e.fieldNames.push(t.name),e.fieldNodes.push(e.addField(t))}))})).finally((function(){t.hide()}))},computeHasValues:function(){this.hasValues=Object.keys(this.values).length>0&&Object.values(this.values).some((function(e){return""!==e}))},buildHeaderLine:function(){return this.fieldNames.map((function(e){return'"'.concat(e,'"')})).join(",")},getCurrentLine:function(){var e=this;return this.fieldNames.map((function(t){return e.values[t]||""}))},buildLine:function(e){return e.map((function(e){return'"'.concat(e,'"')})).join(",")},buildCurrentCsvContent:function(){return[this.buildHeaderLine(),this.buildLine(this.getCurrentLine())].join("\r\n")},buildFullCsvContent:function(){var e=this,t=this.lines.map((function(t){return e.buildLine(t)}));return[this.buildHeaderLine()].concat(Object(g["a"])(t)).join("\r\n")},buildFormData:function(){var e=new FormData,t=new Blob(["\ufeff"+this.buildCurrentCsvContent()],{type:"text/csv"});return e.append("file",t,"data.csv"),e.append("schema",this.schemaMeta.schema_url),e},removeFieldNodes:function(){var e=this;this.fieldNodes.forEach((function(t){e.$refs.container.removeChild(t)})),this.fieldNodes=[]},isAddressField:function(e){var t=["ad_","addr_","address","adr_","adresse"],n=e.name.toLowerCase();return t.some((function(e){return n.includes(e)}))},addField:function(e){var t=this,n=e.constraints&&e.constraints.enum,i="boolean"===e.type,s=function(e,n){var i=r["a"].extend(e),s=new i({propsData:{field:n}});return s.$mount(),t.$refs.container.appendChild(s.$el)};return n?s(T,e):i?s(Q,e):isAddressField(e)?s(se,e):s(q,e)},dispatchError:function(e){var t=e["column-number"];this.faultyFields.push(this.fieldNames[t-1]),w.$emit("field-error",this.fieldNames[t-1],e)},dispatchNoError:function(){var e=this;this.fieldNames.forEach((function(t){-1===e.faultyFields.indexOf(t)&&w.$emit("field-no-error",t)}))},dispatchFormValidated:function(){w.$emit("form-validated")},dispatchReset:function(){w.$emit("form-reset")},submit:function(){var e=this,t=this.$loading.show();fetch("".concat(re,"/validate"),{method:"POST",body:this.buildFormData()}).then((function(e){return e.json()})).then((function(t){e.formValidated=!0,e.faultyFields=[];var n=t.report.tables[0].errors;n&&n.length>0?n.forEach((function(t){e.dispatchError(t)})):(e.addingLine=!1,e.lines.push(e.getCurrentLine()),e.values={}),e.dispatchNoError(),e.dispatchFormValidated()})).finally((function(){t.hide()}))},addLine:function(){this.addingLine=!0,this.formValidated=!1,this.dispatchReset()},deleteLine:function(e){this.lines.splice(e,1),0===this.lines.length&&this.addLine()}}},oe=ae,le=Object(l["a"])(oe,v,b,!1,null,null,null),ue=le.exports;function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){Object(p["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fe="https://schema.data.gouv.fr/schemas/schemas.json",me={name:"home",components:{SchemaForm:ue},data:function(){return{schemaName:this.$route.query.schema,schemas:null,options:[]}},mounted:function(){var e=this,t=this.$loading.show();fetch("".concat(fe)).then((function(e){return e.json()})).then((function(t){e.schemas=t.schemas,e.options=e.schemas.map((function(e){return{value:e.name,text:e.title||e.name}}))})).finally((function(){t.hide()}))},computed:{schema:function(){var e=this;if(this.schemaName&&this.schemas)return this.schemas.find((function(t){return t.name===e.schemaName}))}},watch:{schemaName:function(e){this.$router.push({query:de({},this.$route.query,{schema:e})})}}},he=me,pe=Object(l["a"])(he,m,h,!1,null,null,null),ve=pe.exports;r["a"].use(f["a"]);var be=new f["a"]({mode:"history",base:"/",routes:[{path:"/:schema",name:"home_schema",component:ve},{path:"/",name:"home",component:ve}]}),ge=n("9f7b"),_e=n.n(ge),ye=n("9062"),we=n.n(ye);n("e40d"),n("f9e3"),n("2dd8"),n("c4c9");r["a"].config.productionTip=!1,r["a"].use(_e.a),r["a"].use(we.a),r["a"].component("vue-simple-suggest",Y["a"]),new r["a"]({router:be,render:function(e){return e(d)}}).$mount("#app")},7857:function(e,t,n){"use strict";var i=n("0b50"),s=n.n(i);s.a},a036:function(e,t,n){"use strict";var i=n("a666"),s=n.n(i);s.a},a666:function(e,t,n){}});
//# sourceMappingURL=app.b3eb1a56.js.map